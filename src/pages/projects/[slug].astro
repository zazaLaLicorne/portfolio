---
import { Image } from "astro:assets";
import projects from "@/data/projects.json";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Button from "@/components/Button.astro";

// G√©n√©rer toutes les routes statiques
export function getStaticPaths() {
  return projects.map((projet) => ({
    params: { slug: projet.slug },
    props: { projet },
  }));
}

// R√©cup√©rer le projet depuis les props
const { projet } = Astro.props;

if (!projet) {
  throw new Error(`Projet introuvable`);
}

// Pour les ic√¥nes tech du dossier public/icons
function techIcon(name) {
  return `/icons/${name.toLowerCase()}.webp`;
}

// Pour la date plus lisible
const date = new Date(projet.date).toLocaleDateString("fr-FR", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<!-- PAGE PROJET -->
<BaseLayout>    
<section class="section container !min-h-fit py-20 text-center">
  <div data-aos="fade-up" class="max-w-4xl mx-auto">

    <!-- Titre + badge -->
    <h1 class="text-4xl font-bold mb-4">{projet.title}</h1>

    {projet.badge && (
      <span class="inline-block bg-accent text-white px-3 py-1 rounded-lg mb-6">
        {projet.badge}
      </span>
    )}

    <p class="opacity-80 mb-10 text-sm">
      Projet publi√© le {date}
    </p>

    <!-- Thumbnail -->
    <div data-aos="zoom-in" class="rounded-xl overflow-hidden shadow-lg mb-12">
      <Image
        src={projet.thumbnail}
        alt={projet.title}
        width={1200}
        height={700}
        loading="lazy"
        class="w-full h-auto object-cover"
      />
    </div>

    <!-- Description -->
    <div data-aos="fade-up" class="prose dark:prose-invert max-w-none mb-12">
      <p class="text-lg leading-relaxed">
        {projet.description}
      </p>
    </div>

    <!-- Tech Stack -->
    <div data-aos="fade-up" class="mb-16">
      <h2 class="text-2xl font-semibold mb-4">Technologies utilis√©es</h2>
      <div class="flex flex-wrap justify-center gap-6">
        {projet.techs.map((tech) => (
          <div class="flex flex-col gap-3" data-aos="zoom-in" data-aos-delay="100">
            <Image
              src={techIcon(tech)}
              alt={tech}
              width={40}
              height={40}
              class="w-10 h-10"
              loading="lazy"
            />
            <span class="text-lg">{tech}</span>
          </div>
        ))}
      </div>
    </div>
        <!-- Liens externes -->
    <div data-aos="fade-up" class="flex flex-col gap-6 mb-20">
    <h2 class="text-2xl font-semibold mb-4">Liens du projet</h2>
      {projet.project_url && (
        <Button variant="projet" href={projet.project_url} target="_blank">
          Voir le site
     </Button>
      )}

      {projet.github_url && (
        <Button variant="projet" href={projet.github_url} target="_blank">
            <img src="/icons/github.webp" alt="GitHub" class="w-5 h-5" />
            Voir le code
        </Button>
      )}
    </div>

    <!-- Notes -->
    {projet.scores && (
  <div class="mt-20" data-aos="fade-up">
    <h2 class="text-2xl font-semibold mb-6">Scores du projet</h2>

    <!-- TABLEAU SECURITY HEADERS -->
    <div class="overflow-x-auto justify-self-center mb-10">
      <table class="table-auto border-collapse rounded-xl overflow-hidden shadow-lg">
        <thead class="bg-gray-200 dark:bg-gray-700">
          <tr>
            <th class="p-4 font-bold">Test</th>
            <th class="p-4  font-bold">Note</th>
          </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800">
          <tr class="border-t border-gray-300 dark:border-gray-700">
            <td class="p-4 font-medium">Security Headers</td>
            <td class="p-4 font-bold text-accent">
              {projet.scores.security_headers}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- TABLEAU LIGHTHOUSE -->
    <h3 class="text-xl font-semibold mb-4">Lighthouse</h3>

    <div class="overflow-x-auto ">
      <table class="table-auto w-full border-collapse rounded-xl overflow-hidden shadow-lg">
        <thead class="bg-gray-200 dark:bg-gray-700">
          <tr>
            <th class="p-4 font-bold ">Plateforme</th>
            <th class="p-4 font-bold ">Performance</th>
            <th class="p-4 font-bold ">Accessibilit√©</th>
            <th class="p-4 font-bold ">Best Practices</th>
            <th class="p-4 font-bold ">SEO</th>
          </tr>
        </thead>

        <tbody class="text-center bg-white dark:bg-gray-800">

          <!-- DESKTOP -->
          <tr class="border-t border-gray-300 dark:border-gray-700">
            <td class="p-4 font-medium ">Desktop</td>
            <td class="p-4 ">{projet.scores.lighthouse.desktop.performance}</td>
            <td class="p-4 ">{projet.scores.lighthouse.desktop.accessibility}</td>
            <td class="p-4 ">{projet.scores.lighthouse.desktop.best_practices}</td>
            <td class="p-4 ">{projet.scores.lighthouse.desktop.seo}</td>
          </tr>

          <!-- MOBILE -->
          <tr class="border-t border-gray-300 dark:border-gray-700">
            <td class="p-4 font-medium ">Mobile</td>
            <td class="p-4 ">{projet.scores.lighthouse.mobile.performance}</td>
            <td class="p-4 ">{projet.scores.lighthouse.mobile.accessibility}</td>
            <td class="p-4 ">{projet.scores.lighthouse.mobile.best_practices}</td>
            <td class="p-4 ">{projet.scores.lighthouse.mobile.seo}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
)}

    <!-- Vid√©os du projet -->
{projet.videos && (
  <div class="mt-20" data-aos="fade-up">
    <h2 class="text-2xl font-semibold mb-6">Vid√©os de pr√©sentation</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-10" data-aos="zoom-in">

      <!-- üé• Desktop -->
      {projet.videos.desktop && (
        <div class="video-card rounded-xl overflow-hidden shadow-lg bg-black">
          <iframe
            class="w-full aspect-video"
            src={projet.videos.desktop.replace("youtu.be", "www.youtube.com/embed")}
            loading="lazy"
            allowfullscreen
          ></iframe>
          <p class="text-center text-sm opacity-80 py-2">Version Desktop</p>
        </div>
      )}

      <!-- üé• Tablet Landscape -->
      {projet.videos.tablet?.landscape && (
        <div class="video-card rounded-xl overflow-hidden shadow-lg bg-black">
          <iframe
            class="w-full aspect-video"
            src={projet.videos.tablet.landscape.replace("youtu.be", "www.youtube.com/embed")}
            loading="lazy"
            allowfullscreen
          ></iframe>
          <p class="text-center text-sm opacity-80 py-2">Tablette (Paysage)</p>
        </div>
      )}

      <!-- üé• Mobile Landscape -->
      {projet.videos.mobile?.landscape && (
        <div class="video-card rounded-xl overflow-hidden shadow-lg bg-black">
          <iframe
            class="w-full aspect-video"
            src={projet.videos.mobile.landscape.replace("youtu.be", "www.youtube.com/embed")}
            loading="lazy"
            allowfullscreen
          ></iframe>
          <p class="text-center text-sm opacity-80 py-2">Mobile (Paysage)</p>
        </div>
      )}

      <!-- üé• Mobile Portrait -->
      {projet.videos.mobile?.portrait && projet.videos.mobile.portrait !== "" && (
        <div class="video-card rounded-xl overflow-hidden shadow-lg bg-black">
          <iframe
            class="w-full aspect-video"
            src={projet.videos.mobile.portrait.replace("youtu.be", "www.youtube.com/embed")}
            loading="lazy"
            allowfullscreen
          ></iframe>
          <p class="text-center text-sm opacity-80 py-2">Mobile (Portrait)</p>
        </div>
      )}

    </div>
  </div>
)}

    <!-- Galerie / screenshots si existants -->
    {projet.images?.length > 0 && (
      <div data-aos="fade-up">
        <h2 class="text-2xl font-semibold mb-4">Galerie</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {projet.images.map((img) => (
            <div class="rounded-xl overflow-hidden shadow-lg">
              <Image
                src={img}
                alt="Screenshot du projet"
                width={800}
                height={600}
                class="w-full object-cover"
                loading="lazy"
              />
            </div>
          ))}
        </div>
      </div>
    )}
  </div>
  <Button variant="retour" href="/projects/page/1">
    ‚Üê Retour √† la liste des projets</Button>
</section>
</BaseLayout> 