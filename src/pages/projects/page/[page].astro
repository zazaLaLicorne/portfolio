---
import ProjectCard from "@/components/ProjectCard.astro";
import Button from "@/components/Button.astro";
import allProjects from "@/data/projects.json";
import BaseLayout from "@/layouts/BaseLayout.astro";

export function getStaticPaths() {
  // Toutes les constantes DANS getStaticPaths
  const PER_PAGE = 4;
  const priorityOrder = { high: 1, medium: 2, low: 3 };
  
  const sortedProjects = [...allProjects].sort(
    (a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]
  );
  
  const totalPages = Math.ceil(sortedProjects.length / PER_PAGE);

  return Array.from({ length: totalPages }).map((_, i) => {
    const start = (i) * PER_PAGE;
    const projects = sortedProjects.slice(start, start + PER_PAGE);
    
    return {
      params: { page: String(i + 1) },
      props: { 
        currentPage: i + 1, 
        totalPages,
        projects // On passe directement les projets de la page
      },
    };
  });
}

// Récupération des props
const { currentPage, totalPages, projects } = Astro.props;
---
<BaseLayout>
<section class="flex flex-col justify-start items-center text-center gap-8">
  <h2 class="text-3xl font-bold mb-10 text-center">Mes projets</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
    {projects.map((item, i) => (
    <ProjectCard projet={item} />
  ))}
  </div>

 <div class="flex justify-center items-center gap-6 mt-12">
  {currentPage > 1 && (
    <Button 
      href={currentPage === 2 ? "/#realisations" : `/projects/page/${currentPage - 1}`} 
      variant="pagination"
    >
      ← Précédent
    </Button>
  )}

  <span class="text-lg opacity-80">
    Page {currentPage} / {totalPages}
  </span>

  {currentPage < totalPages && (
    <Button 
      href={`/projects/page/${currentPage + 1}`} 
      variant="pagination"
    >
      Suivant →
    </Button>
  )}
</div>
</section>
</BaseLayout>