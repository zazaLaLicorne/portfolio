---
import { Image } from "astro:assets";
const { review } = Astro.props;

const hasAvatar = review.image && review.image.trim() !== "";
let sourceIcon = "";

const date = review.date
  ? new Date(review.date.split("/").reverse().join("-")).toLocaleDateString("fr-FR")
  : "";

const source = review.source?.toLowerCase();

if (source === "linkedin") {
  sourceIcon = `
    <svg class="w-10 h-10" fill="#0077B5" viewBox="0 0 24 24">
      <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.27-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452z"/>
    </svg>
  `;
}

if (source === "malt") {
  sourceIcon = `
   <svg class="w-10 h-10" fill="#FC5757" viewBox="0 0 512 512">
  <path d="m408.4 103.8c-32.5-32.4-67.1-11.4-88.8 10.2L114.8 318.8c-21.7 21.7-44.4 54.7-10.2 88.8c34.1 34.1 67 11.4 88.7-10.3l204.8-204.8c21.7-21.6 42.7-56.3 10.3-88.7zm-195.7-8.4 43.4 43.4 44.1-44.2c3-3 6-5.8 9.1-8.4c-4.6-23.3-17.9-44.4-53.3-44.4c-35.4 0-48.7 21.2-53.2 44.5c3.3 2.9 6.6 5.8 9.9 9.1zm87.5 322.1-44.1-44.1-43.4 43.3c-3.3 3.3-6.5 6.4-9.8 9.2c5 23.8 19 45.5 53.1 45.5c34.2 0 48.3-21.9 53.2-45.7c-3-2.6-6-5.2-9-8.2zm-105.9-217h-83.6c-30.7 0-70 9.7-70 55.5c0 34.3 21.9 48.3 45.8 53.2c2.8-3.2 107.8-108.7 107.8-108.7zm231.5 2.3c-2.6 3-107.9 108.8-107.9 108.8h82.4c30.7 0 70-7.3 70-55.6c0-35.3-21.1-48.6-44.5-53.2zm-204.1-29.7 14.9-14.9-43.3-43.4c-21.7-21.7-54.6-44.4-88.8-10.2c-25 25-19.4 49.4-6.2 69.1c4.1-.3 123.4-.6 123.4-.6zm68.7 165.9-15 15 44.2 44.1c21.7 21.7 56.3 42.7 88.7 10.3c24.2-24.2 18.7-49.7 5.3-70c-4.3.3-123.2.6-123.2.6z"/>
</svg>
  `;
}

if (source === "google") {
  sourceIcon = `
 <svg 
  class="w-10 h-10" 
  viewBox="0 0 32 32" 
  xmlns="http://www.w3.org/2000/svg"
>
  <path d="M23.75,16A7.7446,7.7446,0,0,1,8.7177,18.6259L4.2849,22.1721A13.244,13.244,0,0,0,29.25,16" fill="#00ac47"/>
  <path d="M23.75,16a7.7387,7.7387,0,0,1-3.2516,6.2987l4.3824,3.5059A13.2042,13.2042,0,0,0,29.25,16" fill="#4285f4"/>
  <path d="M8.25,16a7.698,7.698,0,0,1,.4677-2.6259L4.2849,9.8279a13.177,13.177,0,0,0,0,12.3442l4.4328-3.5462A7.698,7.698,0,0,1,8.25,16Z" fill="#ffba00"/>
  <path d="M16,8.25a7.699,7.699,0,0,1,4.558,1.4958l4.06-3.7893A13.2152,13.2152,0,0,0,4.2849,9.8279l4.4328,3.5462A7.756,7.756,0,0,1,16,8.25Z" fill="#ea4435"/>
  <path d="M29.25,15v1L27,19.5H16.5V14H28.25A1,1,0,0,1,29.25,15Z" fill="#4285f4"/>
</svg>
`;
}
---

<div
  data-aos="zoom-in-up"
  data-aos-delay="200"
  data-aos-duration="900"
  data-aos-easing="cubic-bezier(.21,.98,.6,1)"
  class="p-6 rounded-xl shadow-lg glass
         border border-gray-200 dark:border-gray-700"
>
  <div class="flex items-center justify-self-center text-center gap-4 mb-4">
    {
      hasAvatar ? (
        <Image
          src={review.image}
          alt={review.author}
          width={50}
          height={50}
          class="w-14 h-14 rounded-full object-cover border"
          loading="lazy"
        />
      ) : (
        <div
          class="w-14 h-14 rounded-full border flex items-center justify-center
               bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 
               font-semibold text-xl uppercase"
        >
          {review.author ? review.author[0] : "?"}
        </div>
      )
    }

    <div class="">
      <h3 class="text-lg font-bold text-gray-800 dark:text-white">
        {review.author}
      </h3>
      <p class="text-sm text-gray-500 dark:text-gray-400">{review.role}</p>

    </div>
  </div>

  {
    review.rating && (
      <div class="flex gap-1 justify-center mb-3">
        {Array.from({ length: review.rating }).map(() => (
          <span class="text-yellow-400 text-xl">â˜…</span>
        ))}
      </div>
    )
  }

  <p class="text-gray-700 text-center dark:text-gray-300 leading-relaxed mb-4">
    {review.content}
  </p>

  <div class="flex justify-center gap-2 mt-1" set:html={sourceIcon} />
  <p class="text-sm justify-self-center text-gray-400">
    {date}
  </p>
</div>
